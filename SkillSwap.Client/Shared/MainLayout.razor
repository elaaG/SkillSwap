@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject IAuthService AuthService
@inject AuthenticationStateProvider AuthStateProvider

<div class="page">
    <AuthorizeView>
        <Authorized>
            <div class="sidebar">
                <div class="top-row">
                    <a href="/" class="navbar-brand">
                        <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary-600), var(--primary-800)); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
                                <span style="font-size: 1.25rem;">🎓</span>
                            </div>
                            <span style="font-size: 1.5rem; font-weight: 800; letter-spacing: -0.02em;">SkillSwap</span>
                        </div>
                    </a>
                </div>

                <nav class="nav-menu">
                    <NavLink href="/" Match="NavLinkMatch.All">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                            </svg>
                        </span>
                        <span>Dashboard</span>
                    </NavLink>
                    
                    <NavLink href="/profile">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                        </span>
                        <span>Profile</span>
                    </NavLink>
                    
                    <NavLink href="/wallet">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
                            </svg>
                        </span>
                        <span>Wallet</span>
                    </NavLink>
                    
                    <NavLink href="/skills">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                            </svg>
                        </span>
                        <span>Skills</span>
                    </NavLink>
                    
                    <NavLink href="/listings">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                            </svg>
                        </span>
                        <span>Listings</span>
                    </NavLink>
                    
                    <div class="nav-divider"></div>
                   
                    
                    <a href="#" class="nav-link disabled">
                        <span class="nav-icon">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                            </svg>
                        </span>
                        <span>Bookings</span>
                        <span class="badge-soon">Soon</span>
                    </a>
                </nav>

                <div class="sidebar-footer">


                    <button class="btn btn-danger btn-block" @onclick="HandleLogout">
                        <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Sign Out
                    </button>
                </div>
            </div>

            <main class="main-content">
                <div class="top-bar">
                    <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-3);">
                            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary-600), var(--primary-800)); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 1rem;">@GetPageIcon()</span>
                            </div>
                            <h2 style="margin: 0; font-size: 1.25rem; font-weight: 700; color: var(--gray-900);">
                                @GetPageTitle()
                            </h2>
                        </div>
                    </div>
                </div>
                
                <div>
                    @Body
                </div>
            </main>
        </Authorized>
        <NotAuthorized>
            @Body
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private async Task HandleLogout()
    {
        var authProvider = (CustomAuthStateProvider)AuthStateProvider;
        await authProvider.MarkUserAsLoggedOutAsync();
        Navigation.NavigateTo("/login");
    }

    private string GetPageTitle()
    {
        var path = Navigation.ToBaseRelativePath(Navigation.Uri);
        return path switch
        {
            "" => "Dashboard",
            "profile" => "My Profile",
            "wallet" => "My Wallet",
            _ => "SkillSwap"
        };
    }

    private string GetPageIcon()
    {
        var path = Navigation.ToBaseRelativePath(Navigation.Uri);
        return path switch
        {
            "" => "🏠",
            "profile" => "👤",
            "wallet" => "💳",
            _ => "🎓"
        };
    }

    private string GetUserInitials(string? name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return "U";

        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 0)
            return "U";

        if (parts.Length == 1)
            return parts[0][0].ToString().ToUpper();

        return (parts[0][0].ToString() + parts[^1][0].ToString()).ToUpper();
    }
    private string CurrentUserName = "User";

protected override async Task OnInitializedAsync()
{
    var authState = await AuthStateProvider.GetAuthenticationStateAsync();
    var user = authState.User;

    if (user.Identity?.IsAuthenticated ?? false)
    {
        CurrentUserName = user.Identity.Name ?? "User";
    }
}

}
